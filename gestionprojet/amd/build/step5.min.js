define(["jquery","mod_gestionprojet/autosave","core/str","core/ajax"],function(a,u,t,m){return{init:function(t){var n=t.cmid,e=t.step,o=t.groupid,i=t.autosaveInterval,r=t.isLocked,s=t.strings||{};function c(t){m.call([{methodname:"mod_gestionprojet_submit_step",args:{cmid:n,step:e,action:t}}])[0].done(function(t){t.success?window.location.reload():alert("Error: "+(t.message||"Unknown error"))}).fail(function(t){console.error("Submission error",t)})}a("#submitButton").on("click",function(){confirm(s.confirm_submission)&&c("submit")}),a("#revertButton").on("click",function(){confirm(s.confirm_revert)&&c("revert")}),a("#exportPdfBtn").on("click",function(){alert(s.export_pdf_coming_soon||"Export PDF coming soon")});r||u.init({cmid:n,step:e,groupid:o,interval:i,formSelector:"#essaiForm",serialize:function(){for(var t={},n=(a("#essaiForm").find('input[type="text"], input[type="date"], textarea').each(function(){this.name&&!this.name.startsWith("precaution_")&&(t[this.name]=this.value)}),[]),e=1;e<=6;e++){var o=document.getElementById("precaution_"+e);o&&n.push(o.value)}return t.precautions=JSON.stringify(n),t}})}}});