/**
 * Submission handling for student step pages.
 *
 * @module     mod_gestionprojet/submission
 * @copyright  2026 Emmanuel REMY
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define(["core/ajax","core/str"],function(e,i){var r={};function t(e,i){for(e.disabled=!1;e.firstChild;)e.removeChild(e.firstChild);var r;for(r=0;r<i.length;r++)e.appendChild(i[r])}return{init:function(i){r=i||{};var n=document.getElementById("submitStepBtn");n&&n.addEventListener("click",function(){!function(i){var n=r.strings.confirm_submit||"Are you sure?";if(!confirm(n))return;var s,o=[];for(s=0;s<i.childNodes.length;s++)o.push(i.childNodes[s].cloneNode(!0));i.disabled=!0;for(;i.firstChild;)i.removeChild(i.firstChild);var d=document.createElement("span");d.className="spinner-border spinner-border-sm",d.setAttribute("role","status"),i.appendChild(d),i.appendChild(document.createTextNode(" "+(r.strings.submitting||"Submitting..."))),e.call([{methodname:"mod_gestionprojet_submit_step",args:{cmid:r.cmid,step:r.step,action:"submit"}}])[0].done(function(e){if(e.success)window.location.reload();else{t(i,o);var n=r.strings.submission_error||"Error";alert(e.message||n)}}).fail(function(){t(i,o),alert(r.strings.submission_error||"Error")})}(this)})}}});