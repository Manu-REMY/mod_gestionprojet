define(["jquery","core/ajax","core/notification","core/str"],function(a,c,s,d){return{init:function(n){var o=a("#id_test_api_btn");o.length&&o.on("click",function(e){e.preventDefault();var t,e=a("#id_ai_provider").val(),r=a("#id_ai_api_key").val(),i=-1!==["albert"].indexOf(e);e?r||i?(t=o.text(),o.prop("disabled",!0).text("Testing..."),c.call([{methodname:"mod_gestionprojet_test_api_connection",args:{cmid:n,provider:e,apikey:i?"":r}}])[0].done(function(e){e.success?s.alert("Success",e.message,"OK"):s.alert("Error",e.message,"OK")}).fail(function(e){s.alert("Error","Connection failed: "+(e.message||e.error),"OK")}).always(function(){o.prop("disabled",!1).text(t)})):d.get_string("ai_api_key_required","mod_gestionprojet").then(function(e){s.alert("Error",e)}).catch(s.exception):d.get_string("ai_provider_required","mod_gestionprojet").then(function(e){s.alert("Error",e)}).catch(s.exception)})}}});