define(["jquery","mod_gestionprojet/autosave","core/str","core/ajax"],function(u,s,e,l){return{init:function(e){var t=e.cmid,n=e.step,r=e.groupid,o=e.autosaveInterval,a=e.isLocked,c=e.auteurs||[""],i=e.strings||{};function m(e){l.call([{methodname:"mod_gestionprojet_submit_step",args:{cmid:t,step:n,action:e}}])[0].done(function(e){e.success?window.location.reload():alert("Error: "+(e.message||"Unknown error"))}).fail(function(e){console.error("Submission error",e)})}0===c.length&&(c=[""]),u("#submitButton").on("click",function(){confirm(i.confirm_submission)&&m("submit")}),u("#revertButton").on("click",function(){confirm(i.confirm_revert)&&m("revert")}),u("#exportPdfBtn").on("click",function(){alert(i.export_pdf_coming_soon||"Export PDF coming soon")});!function o(){let i=document.getElementById("membersContainer");i.innerHTML="",c.forEach((e,t)=>{var n=document.createElement("div"),r=(n.className="member-group",document.createElement("input"));r.type="text",r.placeholder="Nom et prÃ©nom",r.value=e,(r.readOnly=a)||(r.onchange=e=>{c[t]=e.target.value,u("#rapportForm").trigger("change")},r.oninput=e=>{c[t]=e.target.value}),n.appendChild(r),a||(t===c.length-1?((e=document.createElement("button")).type="button",e.className="btn-add",e.innerHTML="+",e.title="Ajouter un membre",e.onclick=()=>{c.push(""),o()},n.appendChild(e)):((r=document.createElement("button")).type="button",r.className="btn-remove",r.innerHTML="âœ•",r.title="Retirer ce membre",r.onclick=()=>{1<c.length&&(c.splice(t,1),o(),u("#rapportForm").trigger("change"))},n.appendChild(r))),i.appendChild(n)})}(),a||s.init({cmid:t,step:n,groupid:r,interval:o,formSelector:"#rapportForm",serialize:function(){var e={};return u("#rapportForm").find('input[type="text"], textarea').each(function(){this.name&&(e[this.name]=this.value)}),e.auteurs=JSON.stringify(c.filter(e=>e&&""!==e.trim())),e}})}}});