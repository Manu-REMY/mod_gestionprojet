define(["jquery","core/ajax","core/notification","core/str","core/templates"],function(t,s,i,n,e){function r(a,r){var o=document.getElementById("grade-distribution-"+a);o&&(void 0===window.Chart?require(["core/chartjs"],function(e){p(o,a,r,e)}):p(o,a,r,window.Chart))}function d(e,a,r){r.prop("disabled",!0);var o=r.find("i");o.removeClass("fa-sync-alt").addClass("fa-spinner fa-spin"),s.call([{methodname:"mod_gestionprojet_generate_ai_summary",args:{cmid:e,step:a,force:!0}}])[0].done(function(e){e.success?(n.get_string("dashboard:summary_refreshed","gestionprojet").done(function(e){l(e,"success")}),setTimeout(function(){location.reload()},1e3)):(i.alert(M.util.get_string("error","moodle")||"Error",e.message),r.prop("disabled",!1),o.removeClass("fa-spinner fa-spin").addClass("fa-sync-alt"))}).fail(function(e){i.exception(e),r.prop("disabled",!1),o.removeClass("fa-spinner fa-spin").addClass("fa-sync-alt")})}var c={},p=function(e,a,r,o){c[a]&&c[a].destroy();e=e.getContext("2d");c[a]=new o(e,{type:"bar",data:{labels:["0-4","5-8","9-12","13-16","17-20"],datasets:[{label:"",data:r,backgroundColor:["rgba(220, 53, 69, 0.7)","rgba(255, 193, 7, 0.7)","rgba(23, 162, 184, 0.7)","rgba(40, 167, 69, 0.7)","rgba(0, 123, 255, 0.7)"],borderColor:["rgba(220, 53, 69, 1)","rgba(255, 193, 7, 1)","rgba(23, 162, 184, 1)","rgba(40, 167, 69, 1)","rgba(0, 123, 255, 1)"],borderWidth:1,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){e=e.raw;return e+(1===e?" soumission":" soumissions")}}}},scales:{y:{beginAtZero:!0,ticks:{stepSize:1,precision:0},grid:{color:"rgba(0, 0, 0, 0.05)"}},x:{grid:{display:!1}}}}})},l=function(e,a){var a="success"===a?"#28a745":"error"===a?"#dc3545":"#17a2b8",r=t('<div class="gestionprojet-toast"></div>').text(e).css({position:"fixed",bottom:"20px",right:"20px",background:a,color:"white",padding:"12px 24px","border-radius":"8px","box-shadow":"0 4px 12px rgba(0,0,0,0.15)","z-index":"9999","font-size":"14px",opacity:"0",transition:"opacity 0.3s ease"});t("body").append(r),setTimeout(function(){r.css("opacity","1")},10),setTimeout(function(){r.css("opacity","0"),setTimeout(function(){r.remove()},300)},3e3)};return{init:function(o,e,a){r(e,a),t(document).off("click.dashboard-refresh-"+e).on("click.dashboard-refresh-"+e,'.refresh-summary-btn[data-step="'+e+'"]',function(e){e.preventDefault();var e=t(this),a=e.data("cmid")||o,r=e.data("step");d(a,r,e)})},initGradeChart:r,refreshSummary:d}});